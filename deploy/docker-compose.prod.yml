# ERP Production - erp.dincouture.pk
# Run from project root:
#   cd /root/NEWPOSV3 && bash deploy/deploy.sh
# Storage RLS is applied automatically by deploy.sh (no extra env needed).

services:
  erp:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
        VITE_DISABLE_REALTIME: ${VITE_DISABLE_REALTIME:-true}
    env_file: ../.env.production
    container_name: erp-frontend
    restart: always
    # Use 3001 when 3000 is taken (e.g. Dokploy). Traefik can route erp.dincouture.pk to erp-frontend:80 on same network.
    ports:
      - "3001:80"
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:80/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - default
      - supabase_default

networks:
  supabase_default:
    external: true
