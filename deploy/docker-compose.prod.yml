# ERP Production - erp.dincouture.pk
# Run from project root:
#   cp deploy/.env.production.example .env.production && edit .env.production
#   docker compose -f deploy/docker-compose.prod.yml --project-directory . --env-file .env.production up -d --build
# If port 3000 is in use (e.g. Dokploy), change ports below to "3001:80" and point Traefik to 3001.
# UFW: 22, 80, 443 only. Never expose 5432.

services:
  erp:
    build:
      context: .
      dockerfile: deploy/Dockerfile
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    env_file: .env.production
    container_name: erp-frontend
    restart: always
    ports:
      - "3000:80"
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:80/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
